import _ from 'lodash';
import processorArrayConverter from '../processors/processor_array/converter';

export default {
  kibanaToEs: function (pipelineApiDocument, ingestManager) {
    const result = {
      description: pipelineApiDocument.description,
      processors: processorArrayConverter.kibanaToEs(pipelineApiDocument.processors, ingestManager)
    };

    if (pipelineApiDocument.failure_action === 'on_error' &&
      pipelineApiDocument.failure_processors.length > 0) {
      result.on_failure = processorArrayConverter.kibanaToEs(pipelineApiDocument.failure_processors);
    }

    return result;
  },
  esToKibana: function (pipelineEsDocument, ingestManager) {
    const pipelineId = _.keys(pipelineEsDocument)[0];
    pipelineEsDocument = _.get(pipelineEsDocument, pipelineId);

    const result = {
      pipeline_id: pipelineId,
      description: pipelineEsDocument.description,
      processors: processorArrayConverter.esToKibana(pipelineEsDocument.processors, ingestManager)
    };

    if (pipelineEsDocument.on_failure) {
      result.failure_action = 'on_error';
      result.failure_processors = processorArrayConverter.esToKibana(pipelineEsDocument.on_failure);
    } else {
      result.failure_action = 'index_fail';
    }

    return result;
  }
};
